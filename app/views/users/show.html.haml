.profile-container
  -if policy(@user).edit?
    %p.text-right.profile-edit
      %a.edit-button#open-modal{"data-target" => "#form-modal", "data-toggle" => "modal"}
        %i.fas.fa-edit
        Edit
  .user-profile.content-box
    .profile-header
      .profile-picture-box
        %a#open-modal{"data-target" => "#view-picture-modal", "data-toggle" => "modal"}
          - if @user.photo.present?
            = image_tag @user.photo.url(:thumb), class: 'avatar profile-picture'
          - else
            = image_tag 'default.png', class: 'avatar profile-picture'
      %h4= @user.nickname
    .profile-body
      .profile-block
        %p 滞在国 &nbsp;&nbsp; ：
        .profile-country-box
          %p
            -@user.countries.each do |country|
              = country.name
              -unless country == @user.countries.last
                ,
      .profile-block
        %p ひとこと：
        %p.field-text
          -if @user.description
            = @user.description
    .profile-posts-block
      %span 過去の投稿
      .profile-posts
        = link_to user_posts_url(@user) do
          %h6
            = image_tag 'globeicon.png', class: 'icon'
            ここでの「ふつう」
            = "(#{@user.posts.count})"
            %i.fas.fa-angle-right

// Modals

// Edit

-if policy(@user).edit?
  #form-modal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "exampleModalCenterTitle", :role => "dialog", :tabindex => "-1"}
    .modal-dialog{:role => "document"}
      .modal-content
        .modal-header
          %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
            %span{"aria-hidden" => "true"} ×
        .modal-body
          =render 'users/edit'

// Photo Viewer

#view-picture-modal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "exampleModalCenterTitle", :role => "dialog", :tabindex => "-1"}
  .modal-dialog.modal-photo{:role => "document"}
    .modal-content
      .modal-header
        %h4= @user.nickname
        %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
          %span{"aria-hidden" => "true"} ×
        %button.previous-content.close
          <
      .modal-body
        =render partial: 'users/avatar_viewer', locals: { user: @user }
        .fakemodal-container
          .fakemodal-box
            = image_tag @user.photo.url(:large), id: 'cropbox'
      = render partial: 'users/edit_avatar', locals: { user: @user }

// Modal

-if session[:modal]

  #edit-picture-modal.modal.fakemodal{"aria-hidden" => "true", "aria-labelledby" => "exampleModalCenterTitle", :role => "dialog", :tabindex => "-1"}
    .modal-dialog.modal-photo{:role => "document"}
      .modal-content
        .modal-header
          %h4= @user.nickname
          %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
            %span{"aria-hidden" => "true"} ×
          %button.previous-content.close
            <
        .modal-body
          .photo-viewer-container
            .fakemodal-box
              = image_tag @user.photo.url(:large), id: 'cropbox-open'
        = form_for @user do |f|
          - %w[x y w h].each do |attribute|
            =f.hidden_field "crop_#{attribute}"
          =f.submit class: 'bttn bttn-action btn-block no-radious'

